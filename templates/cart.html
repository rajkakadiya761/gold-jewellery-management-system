<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arihant Jewellers</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/ari.png') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        .dropdown-menu {
            z-index: 1050;
        }

        /* body {
            background-color: black;
            color: white;
            margin-bottom: 1px;
        } */
        body {
            background-color: black;
            color: white;
            padding: 20px;
        }



        .card {
            background-color: rgb(33, 37, 41);
            border-radius: 10px;
            color: white;
        }

        .sticky-checkout {
            position: sticky;
            bottom: 0;
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 10;
            color: black;
        }

        .dropdown-item:hover {
            background-color: rgb(78, 65, 48);
        }

        .container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #cart-items {
            flex-grow: 1;
        }

        .quantity {
            margin: 0 10px;
        }

        .notification {
            position: fixed;
            background-color: #333;
            color: white;
            border-radius: 5px;

        }

        .notification.warning {
            background-color: #f6d163;
            color: black;
        }

        .notification.error {
            background-color: #ffc107;
            color: white;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-expand-lg text-light bg-black p-3 sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fs-5 text-uppercase fw-bold text-warning">Arihant Jewelers</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-between" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active text-light fw-bold px-3" aria-current="page" href="/#start">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-light fw-bold px-3" href="{{ url_for('page1') }}#About">About us</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle text-light fw-bold px-3" href="#" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false"
                            style="border-radius: 8px; transition: background 0.3s;">
                            Shop by Category
                        </a>
                        <ul class="dropdown-menu bg-dark p-3" style="min-width: 500px;">
                            <div class="row">

                                <!-- Column 1: Products & Material -->
                                <div class="col-md-6">
                                    <h6 class="dropdown-header text-warning">Products</h6>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('product.show_earrings') }}">Earrings</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productFinger.show_rings') }}">Rings</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productHand.show_braceletes') }}">Bracelets</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productNeck.show_necklaces') }}">Necklaces</a>

                                    <hr class="dropdown-divider">

                                    <h6 class="dropdown-header text-warning">Material</h6>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productGold.show_gold_products') }}">Gold Jewellery</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productSilver.show_silver_products') }}">Silver Jewellery</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productPlatinum.show_platinum_products') }}">Platinum
                                        Jewellery</a>
                                </div>

                                <!-- Column 2: For You & Occasion -->
                                <div class="col-md-6">
                                    <h6 class="dropdown-header text-warning">For You</h6>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productMale.show_male_products') }}">Men's Collection</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productFemale.show_female_products') }}">Women's
                                        Collection</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productUni.show_uni_products') }}">Unisex Collection</a>

                                    <hr class="dropdown-divider">

                                    <h6 class="dropdown-header text-warning">Occasion</h6>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productWedding.show_wedding_products') }}">Wedding
                                        Collection</a>
                                    <a class="dropdown-item text-light"
                                        href="{{ url_for('productMinimal.show_minimal_products') }}">Minimal
                                        Collection</a>
                                </div>
                            </div>

                            <!-- Full-Width Latest Collection at Bottom -->
                            <hr class="dropdown-divider">
                            <a class="dropdown-item text-light fw-bold text-center"
                                href="{{ url_for('page1') }}#latest">âœ¨ Our Latest Collection</a>
                        </ul>
                    </li>
                </ul>

                <!-- Centered Search Bar -->
                <form class="d-flex mx-auto" role="search" style="flex: 1; justify-content: center;"
                    action="{{ url_for('search') }}" method="GET">
                    <input class="form-control me-2 p-2" type="search" name="query" placeholder="Search"
                        aria-label="Search" style="width: 60%;">
                    <button type="submit" class="btn btn-outline-warning">Search</button>
                </form>

                <div class="d-flex">
                    {% if session['user_id'] %}
                    <!-- Logout Button -->
                    <form action="{{ url_for('logout') }}" method="POST">
                        <button class="btn btn-outline-warning me-2" type="submit">
                            Logout
                        </button>
                    </form>
                    {% else %}
                    <!-- Login Button -->
                    <button class="btn btn-outline-warning me-2" type="button" data-bs-toggle="modal"
                        data-bs-target="#loginModal">
                        <i class="bi bi-person"></i>
                    </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    {% include 'LoginSignUp_Modal.html' %}

    {% if show_modal %}
    <!-- Modal for Password Reset -->
    <div class="modal fade" id="passwordResetModal" tabindex="-1" aria-labelledby="passwordResetModalLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="passwordResetModalLabel">Reset Your Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="resetPasswordForm" action="/reset-password" method="POST">
                        <div class="mb-3">
                            <label for="resetEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="resetEmail" value="{{ email }}" name="email"
                                readonly>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="newPassword" name="newPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Change Password</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const modal = new bootstrap.Modal(document.getElementById('passwordResetModal'));
            modal.show();
        });

    </script>
    {% endif %}

    <div class="container-fluid mt-4">
        <h2 class="text-center mb-4">ðŸ›’ Shopping Cart</h2>
        <div id="cart-items">
            <div id="notificationMessage" class="notification error p-3 text-center"
                style="display: none; position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 250px; max-width: 300px;">
            </div>
            {% for item in cart_items %}
            <a href="{{ url_for('product.earring_details', product_id=item.product_id) }}"
                class="text-decoration-none text-white">
                <div class="card p-3 mt-3" data-product-id="{{ item.product_id }}">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <!-- <img src="{{ item.photo1 }}" class="img-fluid" alt="{{ item.name }}"> -->
                            {% if "http" in item.photo1 %}
                            <!-- If it's an external URL -->
                            <img src="{{ item.photo1 }}" class="img-fluid" alt="Jewelry">
                            {% else %}
                            <!-- If it's a local image -->
                            <img src="{{ url_for('static', filename=item.photo1) }}" class="img-fluid" alt="Jewelry">
                            {% endif %}

                        </div>
                        <div class="col-md-6 text-center text-md-start">
                            <h5>{{ item.name }}</h5>
                            <span class="fw-bold">â‚¹{{ item.price }}</span>
                        </div>
                        <div class="col-md-2 text-center">
                            <button class="btn btn-outline-secondary"
                                onclick="updateQuantity(this, -1, event)">-</button>
                            <span class="quantity">1</span>
                            <button class="btn btn-outline-secondary"
                                onclick="updateQuantity(this, 1, event)">+</button>
                        </div>
                        <div class="col-md-2 text-center">
                            <button class="btn btn-outline-warning" onclick="removeItem(this, event)">Remove</button>
                        </div>


                    </div>
                </div>

                {% else %}
                <div class="alert alert-warning text-center" role="alert">
                    Your cart is empty.
                </div>
                {% endfor %}
            </a>
        </div>

        <div class="sticky-checkout text-center">
            <h4>Total: â‚¹<span id="total-amount">0</span></h4>
            <button class="btn btn-warning">Checkout</button>
        </div>
    </div>

    <script>
        function showNotification(message, type) {
            $('#notificationMessage').removeClass('success error info').addClass(type);
            $('#notificationMessage').text(message).fadeIn();
            setTimeout(function () {
                $('#notificationMessage').fadeOut();
            }, 3000);
        }

        function updateTotal() {
            let total = 0;
            document.querySelectorAll(".card").forEach(card => {
                let price = parseFloat(card.querySelector(".fw-bold").innerText.replace('â‚¹', ''));
                let quantity = parseInt(card.querySelector(".quantity").innerText);
                total += price * quantity;
            });
            document.getElementById("total-amount").innerText = total.toFixed(2);
        }

        function updateQuantity(button, change, event) {
            event.stopPropagation(); // Prevent the click from propagating to the parent <a> tag
            event.preventDefault(); // Prevent the default link behavior

            let quantityElement = button.parentElement.querySelector(".quantity");
            let quantity = parseInt(quantityElement.innerText);
            quantity = Math.max(1, quantity + change);
            quantityElement.innerText = quantity;
            updateTotal();
        }

        function removeItem(button, event) {
            event.stopPropagation(); // Prevent the click from propagating to the parent <a> tag
            event.preventDefault();

            let card = button.closest(".card");
            let productId = card.getAttribute("data-product-id");

            fetch(`/remove-from-cart/${productId}`, {
                method: 'POST',
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "Item removed from cart") {
                        card.remove();
                        updateTotal();
                        showNotification('Item removed from cart', 'error');
                    } else {
                        showNotification('Failed to remove item from cart', 'error');
                    }
                })
                .catch(error => console.error("Error:", error));
        }



        // Initial total calculation
        updateTotal();
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
</body>

</html>